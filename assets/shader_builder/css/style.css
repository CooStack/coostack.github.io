:root {
    --bg: #0e1218;
    --panel: #151b24;
    --panel2: #121822;
    --card: #1b2330;
    --line: rgba(255, 255, 255, 0.1);
    --line2: rgba(255, 255, 255, 0.16);
    --text: rgba(232, 238, 247, 0.94);
    --muted: rgba(171, 184, 202, 0.66);
    --accent: #6fa8ff;
    --danger: #ff6b6b;
    --ok: #7ad9ff;
    --input-bg: rgba(15, 20, 28, 0.7);
    --shadow: 0 10px 30px rgba(0, 0, 0, 0.32);
    --radius: 14px;
    --radius2: 10px;
    --topbar-h: 56px;
    --font: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", Arial;
}

body[data-theme^="dark"] {
    color-scheme: dark;
}

body[data-theme^="light"] {
    color-scheme: light;
}

body[data-theme="dark-1"] {
    --bg: #0e1218;
    --panel: #151b24;
    --panel2: #121822;
    --card: #1b2330;
    --line: rgba(255, 255, 255, 0.1);
    --line2: rgba(255, 255, 255, 0.16);
    --text: rgba(232, 238, 247, 0.94);
    --muted: rgba(171, 184, 202, 0.66);
    --accent: #6fa8ff;
    --danger: #ff6b6b;
    --ok: #7ad9ff;
    --input-bg: rgba(15, 20, 28, 0.7);
}

body[data-theme="dark-2"] {
    --bg: #0b1513;
    --panel: #101c19;
    --panel2: #0d1614;
    --card: #15221f;
    --line: rgba(255, 255, 255, 0.09);
    --line2: rgba(255, 255, 255, 0.15);
    --text: rgba(225, 245, 239, 0.94);
    --muted: rgba(173, 214, 200, 0.64);
    --accent: #31c8a3;
    --danger: #ff6a79;
    --ok: #70e0c8;
    --input-bg: rgba(10, 18, 16, 0.74);
}

body[data-theme="dark-3"] {
    --bg: #17120f;
    --panel: #211915;
    --panel2: #1b1511;
    --card: #271d18;
    --line: rgba(255, 227, 202, 0.11);
    --line2: rgba(255, 227, 202, 0.18);
    --text: rgba(255, 242, 226, 0.94);
    --muted: rgba(236, 209, 184, 0.62);
    --accent: #ff9a5f;
    --danger: #ff715e;
    --ok: #ffcf8a;
    --input-bg: rgba(25, 18, 14, 0.78);
}

body[data-theme="light-1"] {
    --bg: #e7f4ff;
    --panel: #f8fbff;
    --panel2: #edf5ff;
    --card: #ffffff;
    --line: rgba(49, 81, 126, 0.15);
    --line2: rgba(49, 81, 126, 0.22);
    --text: rgba(28, 46, 70, 0.92);
    --muted: rgba(40, 62, 90, 0.62);
    --accent: #4a8fdf;
    --danger: #d85252;
    --ok: #43b9c8;
    --input-bg: rgba(255, 255, 255, 0.9);
}

body[data-theme="light-2"] {
    --bg: #fff7f0;
    --panel: #fffefb;
    --panel2: #fff6ee;
    --card: #ffffff;
    --line: rgba(86, 61, 45, 0.14);
    --line2: rgba(86, 61, 45, 0.22);
    --text: rgba(62, 41, 29, 0.92);
    --muted: rgba(84, 56, 40, 0.64);
    --accent: #e6883b;
    --danger: #da5151;
    --ok: #cc9a6b;
    --input-bg: rgba(255, 248, 240, 0.95);
}

body[data-theme="light-3"] {
    --bg: #eefaf6;
    --panel: #fdfefe;
    --panel2: #f1faf6;
    --card: #ffffff;
    --line: rgba(26, 67, 52, 0.14);
    --line2: rgba(26, 67, 52, 0.21);
    --text: rgba(19, 40, 32, 0.92);
    --muted: rgba(19, 40, 32, 0.62);
    --accent: #2bab86;
    --danger: #d24f5a;
    --ok: #49b99c;
    --input-bg: rgba(237, 248, 243, 0.94);
}

* {
    box-sizing: border-box;
}

html,
body {
    height: 100%;
}

body {
    margin: 0;
    font-family: var(--font);
    background:
        radial-gradient(1100px 680px at 15% 8%, color-mix(in srgb, var(--accent) 18%, transparent), transparent 55%),
        radial-gradient(900px 540px at 82% 12%, color-mix(in srgb, var(--ok) 16%, transparent), transparent 58%),
        var(--bg);
    color: var(--text);
    overflow: hidden;
}

#app {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.topbar {
    height: var(--topbar-h);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    padding: 0 12px;
    border-bottom: 1px solid var(--line);
    background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.01));
    backdrop-filter: blur(8px);
}

.topbar-left {
    display: flex;
    align-items: center;
    gap: 12px;
    min-width: 0;
}

.top-home-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
}

.brand {
    display: flex;
    flex-direction: column;
    min-width: 0;
}

.brand-title {
    font-size: 15px;
    font-weight: 700;
    white-space: nowrap;
}

.brand-sub {
    font-size: 12px;
    color: var(--muted);
    white-space: nowrap;
}

.topbar-right {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
    justify-content: flex-end;
}

.sep {
    width: 1px;
    height: 22px;
    background: var(--line2);
}

.btn,
.input,
.code-input {
    border-radius: var(--radius2);
    border: 1px solid var(--line2);
    background: var(--input-bg);
    color: var(--text);
    font: inherit;
}

.btn {
    height: 34px;
    padding: 0 12px;
    cursor: pointer;
    transition: all 0.18s ease;
    text-decoration: none;
}

.btn:hover {
    border-color: color-mix(in srgb, var(--accent) 52%, var(--line2));
}

.btn.primary {
    background: color-mix(in srgb, var(--accent) 23%, var(--input-bg));
    border-color: color-mix(in srgb, var(--accent) 55%, var(--line2));
}

.btn.danger {
    background: color-mix(in srgb, var(--danger) 22%, var(--input-bg));
    border-color: color-mix(in srgb, var(--danger) 55%, var(--line2));
}

.btn.icon {
    width: 34px;
    padding: 0;
}

.btn.small {
    height: 28px;
    padding: 0 10px;
    font-size: 12px;
}

.input {
    height: 34px;
    padding: 0 10px;
    width: 100%;
}

.input-inline {
    width: auto;
    min-width: 132px;
    height: 28px;
    font-size: 12px;
}

.input[type="number"] {
    padding-right: 6px;
}

.proj-name {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    height: 34px;
    border: 1px solid var(--line2);
    border-radius: var(--radius2);
    padding: 0 8px;
    background: color-mix(in srgb, var(--panel) 65%, transparent);
}

.proj-name span {
    font-size: 12px;
    color: var(--muted);
}

.proj-input {
    width: 140px;
    height: 24px;
    padding: 0 8px;
}

.page-switch {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    margin-right: 4px;
}

.page-btn.active {
    background: color-mix(in srgb, var(--accent) 23%, var(--input-bg));
    border-color: color-mix(in srgb, var(--accent) 55%, var(--line2));
}

.layout {
    flex: 1 1 auto;
    min-height: 0;
    display: grid;
    grid-template-columns: minmax(300px, var(--sb-left-w, 30vw)) 8px minmax(380px, 1fr) 8px minmax(360px, var(--sb-right-w, 34vw));
    gap: 10px;
    padding: 10px;
}

.resizer {
    border-radius: 999px;
    align-self: stretch;
    justify-self: center;
    width: 8px;
    cursor: col-resize;
    background: color-mix(in srgb, var(--line2) 72%, transparent);
    transition: background 0.16s ease;
}

.resizer:hover {
    background: color-mix(in srgb, var(--accent) 55%, var(--line2));
}

body.is-resizing {
    user-select: none;
    cursor: col-resize;
}

.panel {
    min-height: 0;
    border-radius: var(--radius);
    border: 1px solid var(--line);
    background: linear-gradient(180deg, color-mix(in srgb, var(--panel) 92%, transparent), color-mix(in srgb, var(--panel2) 88%, transparent));
    box-shadow: var(--shadow);
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.panel-title {
    height: 40px;
    flex: 0 0 40px;
    display: flex;
    align-items: center;
    padding: 0 12px;
    border-bottom: 1px solid var(--line);
    font-weight: 600;
}

.panel.left,
.panel.right {
    overflow: auto;
    padding-bottom: 12px;
}

.card {
    margin: 10px;
    border: 1px solid var(--line);
    border-radius: 12px;
    background: color-mix(in srgb, var(--card) 88%, transparent);
    overflow: hidden;
}

.card.card-resizable {
    resize: vertical;
    overflow: auto;
    min-height: 220px;
    max-height: calc(100vh - var(--topbar-h) - 36px);
}

.card-title {
    padding: 10px 12px;
    font-weight: 600;
    border-bottom: 1px solid var(--line);
}

.card-title-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 8px;
}

.card-title-actions {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.kotlin-target-switch {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 2px;
    border: 1px solid var(--line2);
    border-radius: 999px;
    background: color-mix(in srgb, var(--panel) 72%, transparent);
}

.kotlin-target-btn {
    height: 24px;
    min-width: 56px;
    padding: 0 10px;
    border-radius: 999px;
    border: 1px solid transparent;
    background: transparent;
    color: var(--muted);
    font-size: 12px;
    cursor: pointer;
}

.kotlin-target-btn.active {
    color: var(--text);
    border-color: color-mix(in srgb, var(--accent) 56%, var(--line2));
    background: color-mix(in srgb, var(--accent) 22%, var(--input-bg));
}

.kotlin-block + .kotlin-block {
    border-top: 1px solid var(--line);
}

.form-grid {
    display: grid;
    gap: 8px;
    padding: 10px;
}

.field {
    display: grid;
    gap: 6px;
    font-size: 12px;
    color: var(--muted);
}

.field > span {
    color: var(--muted);
}

.field-note {
    font-size: 11px;
    line-height: 1.3;
    color: var(--muted);
}

.field-inline {
    display: flex;
    align-items: center;
    gap: 8px;
    flex-wrap: wrap;
}

.hint {
    padding: 0 10px 10px;
    font-size: 12px;
    color: var(--muted);
    line-height: 1.45;
}

.chk {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 13px;
    color: var(--text);
}

.chk input {
    width: 16px;
    height: 16px;
}

.list {
    display: grid;
    gap: 6px;
    padding: 10px;
}

.list-item {
    display: grid;
    grid-template-columns: 1fr auto;
    gap: 6px;
    padding: 8px;
    border: 1px solid var(--line);
    border-radius: 10px;
    font-size: 12px;
    background: color-mix(in srgb, var(--panel2) 68%, transparent);
}

.list-item .title {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.list-item .meta {
    min-width: 0;
    display: grid;
    gap: 6px;
}

.list-item .meta .hint {
    padding: 0;
}

.viewer {
    border-radius: var(--radius);
    border: 1px solid var(--line);
    box-shadow: var(--shadow);
    background: color-mix(in srgb, var(--panel2) 94%, transparent);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 0;
}

.viewer-hud {
    min-height: 36px;
    border-bottom: 1px solid var(--line);
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    justify-content: flex-start;
    padding: 0 8px;
    gap: 8px;
}

.badge {
    height: 24px;
    border-radius: 999px;
    border: 1px solid var(--line2);
    background: color-mix(in srgb, var(--panel) 74%, transparent);
    padding: 0 10px;
    font-size: 12px;
    display: inline-flex;
    align-items: center;
    max-width: 100%;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.three-host {
    flex: 1 1 auto;
    min-height: 0;
    position: relative;
}

.three-host canvas {
    display: block;
    width: 100%;
    height: 100%;
}

.graph-wrap {
    position: relative;
    height: 350px;
    margin: 0 10px 10px;
    border: 1px solid var(--line);
    border-radius: 12px;
    overflow: hidden;
    background:
        linear-gradient(180deg, color-mix(in srgb, var(--panel2) 90%, transparent), color-mix(in srgb, var(--panel) 88%, transparent)),
        repeating-linear-gradient(0deg, transparent, transparent 27px, color-mix(in srgb, var(--line2) 40%, transparent) 28px),
        repeating-linear-gradient(90deg, transparent, transparent 27px, color-mix(in srgb, var(--line2) 40%, transparent) 28px);
    user-select: none;
    -webkit-user-select: none;
}

.graph-wrap.panning {
    cursor: grabbing;
}

.graph-selection-box {
    position: absolute;
    border: 1px solid color-mix(in srgb, var(--accent) 70%, white);
    background: color-mix(in srgb, var(--accent) 20%, transparent);
    pointer-events: none;
    z-index: 12;
}

.graph-canvas,
.graph-lines {
    position: absolute;
    inset: 0;
}

.graph-lines {
    z-index: 2;
    pointer-events: none;
}

.graph-canvas {
    z-index: 3;
    pointer-events: none;
    transform-origin: 0 0;
}

.graph-line {
    fill: none;
    stroke: color-mix(in srgb, var(--accent) 65%, white);
    stroke-width: 2;
    pointer-events: none;
}

.graph-line.focused {
    stroke: color-mix(in srgb, var(--accent) 78%, #ffffff);
    stroke-width: 2.4;
}

.graph-line-hit {
    fill: none;
    stroke: rgba(0, 0, 0, 0);
    stroke-width: 24;
    pointer-events: stroke;
    cursor: pointer;
}

.graph-line.selected {
    stroke: color-mix(in srgb, var(--danger) 70%, white);
}

.graph-node {
    position: absolute;
    width: 286px;
    min-height: 110px;
    border: 1px solid var(--line2);
    border-radius: 12px;
    background: color-mix(in srgb, var(--card) 90%, transparent);
    box-shadow: 0 8px 18px rgba(0, 0, 0, 0.26);
    pointer-events: auto;
}

.graph-node.selected {
    border-color: color-mix(in srgb, var(--accent) 68%, white);
}

.graph-node.system {
    border-style: dashed;
}

.graph-node-head {
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 8px;
    border-bottom: 1px solid var(--line);
    cursor: grab;
    user-select: none;
}

.graph-node-head:active {
    cursor: grabbing;
}

.graph-node-title {
    font-size: 12px;
    font-weight: 600;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.graph-node-type {
    font-size: 11px;
    color: var(--muted);
}

.graph-node-body {
    padding: 8px;
    font-size: 12px;
    color: var(--muted);
}

.graph-node-summary {
    margin-bottom: 6px;
    font-size: 11px;
    color: var(--muted);
}

.graph-node-output-hint {
    margin-bottom: 6px;
    font-size: 10px;
    line-height: 1.3;
    color: color-mix(in srgb, var(--text) 64%, var(--muted));
    word-break: break-word;
}

.graph-node-inline {
    display: grid;
    gap: 6px;
}

.graph-node-inline-row {
    display: grid;
    gap: 6px;
}

.graph-node-inline-row.dual {
    grid-template-columns: 1fr 1fr;
}

.graph-node-inline-field {
    min-width: 0;
    display: grid;
    gap: 3px;
}

.graph-node-inline-field-label {
    font-size: 10px;
    color: var(--muted);
    line-height: 1.15;
}

.graph-node-inline-check {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 11px;
    color: var(--text);
}

.graph-node-inline .input {
    min-height: 26px;
    height: 26px;
    padding: 0 8px;
    font-size: 11px;
}

.graph-node-param-head {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 6px;
    font-size: 11px;
    color: var(--muted);
}

.graph-node-param-list {
    display: grid;
    gap: 6px;
}

.graph-node-param-item {
    border: 1px solid var(--line);
    border-radius: 8px;
    padding: 6px;
    display: grid;
    gap: 6px;
    background: color-mix(in srgb, var(--panel2) 72%, transparent);
}

.graph-node-param-controls {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 6px;
}

.graph-node-param-value-source {
    display: grid;
    grid-template-columns: 1fr 2fr;
    gap: 6px;
}

.graph-node-menu {
    position: fixed;
    min-width: 176px;
    display: grid;
    gap: 0;
    border: 1px solid color-mix(in srgb, var(--accent) 46%, var(--line2));
    border-radius: 10px;
    background: color-mix(in srgb, var(--panel2) 95%, transparent);
    box-shadow: 0 16px 34px rgba(0, 0, 0, 0.4);
    z-index: 380;
    overflow: hidden;
}

.graph-node-menu-item {
    width: 100%;
    border: 0;
    border-bottom: 1px solid var(--line);
    background: transparent;
    color: var(--text);
    text-align: left;
    padding: 8px 10px;
    font-size: 12px;
    cursor: pointer;
}

.graph-node-menu-item:last-child {
    border-bottom: 0;
}

.graph-node-menu-item:hover {
    background: color-mix(in srgb, var(--accent) 22%, transparent);
}

.graph-node-menu-item.danger {
    color: color-mix(in srgb, var(--danger) 80%, var(--text));
}

.handle {
    position: absolute;
    transform: translateY(-50%);
    width: 15px;
    height: 15px;
    border-radius: 999px;
    border: 1px solid var(--line2);
    background: color-mix(in srgb, var(--ok) 70%, transparent);
    cursor: crosshair;
    color: color-mix(in srgb, var(--text) 70%, white);
    font-size: 8px;
    line-height: 1;
    padding: 0;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}

.handle.in {
    left: -8px;
}

.handle.out {
    right: -8px;
}

.handle.snap-target {
    transform: translateY(-50%) scale(1.18);
    border-color: color-mix(in srgb, var(--accent) 62%, white);
    box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 24%, transparent);
}

.hidden {
    display: none !important;
}

.sub-head {
    height: 34px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 10px;
    border-top: 1px solid var(--line);
    border-bottom: 1px solid var(--line);
    font-size: 12px;
    color: var(--muted);
}

.param-list {
    display: grid;
    gap: 8px;
    padding: 10px;
}

.param-item {
    border: 1px solid var(--line);
    border-radius: 10px;
    padding: 8px;
    display: grid;
    gap: 6px;
    background: color-mix(in srgb, var(--panel2) 70%, transparent);
}

.param-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr auto;
    gap: 6px;
}

.code-input {
    width: 100%;
    min-height: 130px;
    resize: vertical;
    padding: 8px 10px;
    line-height: 1.45;
    font-family: "Cascadia Mono", Consolas, "JetBrains Mono", monospace;
    font-size: 12px;
}

.editor-field {
    gap: 8px;
}

.editor-shell {
    position: relative;
    border: 1px solid var(--line2);
    border-radius: 12px;
    overflow: hidden;
    background: color-mix(in srgb, var(--panel2) 84%, transparent);
}

.editor-toolbar {
    height: 30px;
    border-bottom: 1px solid var(--line);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 8px;
    background: color-mix(in srgb, var(--panel) 82%, transparent);
}

.editor-title {
    font-size: 12px;
    color: var(--muted);
}

.editor-toolbar-right {
    display: inline-flex;
    align-items: center;
    gap: 8px;
}

.editor-hint {
    font-size: 11px;
    color: var(--muted);
}

.editor-body {
    position: relative;
    min-height: 150px;
    height: 220px;
    overflow: hidden;
}

.editor-highlight,
.editor-textarea {
    position: absolute;
    inset: 0;
    margin: 0;
    padding: 10px;
    border: 0;
    border-radius: 0;
    outline: none;
    font-family: "Cascadia Mono", Consolas, "JetBrains Mono", monospace;
    font-size: 12px;
    line-height: 1.48;
    white-space: pre;
    overflow: auto;
    tab-size: 4;
}

.editor-highlight {
    pointer-events: none;
    color: var(--text);
    background: transparent;
    scrollbar-width: none;
    -ms-overflow-style: none;
}

.editor-highlight::-webkit-scrollbar {
    width: 0;
    height: 0;
}

.editor-textarea {
    background: transparent;
    color: transparent;
    caret-color: var(--text);
    resize: none;
}

.editor-textarea::selection {
    background: color-mix(in srgb, var(--accent) 44%, transparent);
}

.editor-suggest {
    position: absolute;
    left: 10px;
    top: 10px;
    border: 1px solid var(--line2);
    border-radius: 10px;
    background: color-mix(in srgb, var(--panel) 94%, transparent);
    box-shadow: 0 12px 26px rgba(0, 0, 0, 0.35);
    min-width: 250px;
    max-width: min(460px, calc(100% - 16px));
    max-height: min(260px, calc(100% - 16px));
    overflow: auto;
    z-index: 40;
}

.editor-suggest-head {
    position: sticky;
    top: 0;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 7px 9px;
    border-bottom: 1px solid var(--line);
    background: color-mix(in srgb, var(--panel2) 96%, transparent);
    font-family: "Cascadia Mono", Consolas, "JetBrains Mono", monospace;
    font-size: 11px;
}

.editor-suggest-input {
    color: var(--accent);
    font-weight: 700;
}

.editor-suggest-sep {
    color: var(--muted);
}

.editor-suggest-full {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.editor-suggest-item {
    width: 100%;
    border: 0;
    border-bottom: 1px solid var(--line);
    background: transparent;
    color: var(--text);
    padding: 7px 9px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
    font-family: "Cascadia Mono", Consolas, "JetBrains Mono", monospace;
    font-size: 12px;
    text-align: left;
    cursor: pointer;
}

.editor-suggest-label {
    min-width: 0;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.editor-suggest-match {
    color: var(--accent);
    font-weight: 700;
}

.editor-suggest-tail {
    color: var(--muted);
}

.editor-suggest-item:last-child {
    border-bottom: 0;
}

.editor-suggest-item small {
    color: var(--muted);
    font-size: 11px;
}

.editor-suggest-item:hover,
.editor-suggest-item.active {
    background: color-mix(in srgb, var(--accent) 22%, transparent);
}

.editor-shell.maximized {
    position: fixed;
    left: 28px;
    top: 28px;
    right: 28px;
    bottom: 28px;
    z-index: 260;
    border: 1px solid color-mix(in srgb, var(--accent) 48%, var(--line2));
    box-shadow: 0 24px 56px rgba(0, 0, 0, 0.58);
}

.editor-shell.maximized .editor-body {
    height: calc(100% - 30px);
    min-height: calc(100% - 30px);
}

body.editor-max-open::before {
    content: "";
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.35);
    backdrop-filter: blur(2px);
    z-index: 255;
}

.editor-portal-host {
    position: fixed;
    inset: 0;
    z-index: 258;
    pointer-events: none;
}

.editor-portal-host.active {
    pointer-events: auto;
}

.editor-portal-host.active .editor-shell.maximized {
    pointer-events: auto;
}

/* Workspace pages */
body[data-workspace-page="model"] #postGraphCard,
body[data-workspace-page="model"] #nodeEditorCard {
    display: none;
}

body[data-workspace-page="model"] #modelShaderCard {
    max-height: min(74vh, calc(100vh - 128px));
    overflow: auto;
}

body[data-workspace-page="post"] #modelCard,
body[data-workspace-page="post"] #textureCard,
body[data-workspace-page="post"] #modelShaderCard,
body[data-workspace-page="post"] #kotlinCard {
    display: none;
}

body[data-workspace-page="post"] .layout {
    grid-template-columns: minmax(0, 1fr);
    gap: 0;
}

body[data-workspace-page="post"] .panel.right,
body[data-workspace-page="post"] .resizer-left,
body[data-workspace-page="post"] .resizer-right {
    display: none;
}

body[data-workspace-page="post"] .panel.left {
    width: 100%;
    max-width: none;
    padding-bottom: 0;
}

body[data-workspace-page="post"] #postGraphCard {
    margin: 10px;
    min-height: calc(100vh - var(--topbar-h) - 36px);
    display: flex;
    flex-direction: column;
}

body[data-workspace-page="post"] #graphCanvasWrap {
    flex: 1 1 auto;
    height: auto;
    min-height: 520px;
}

body[data-workspace-page="post"] .viewer {
    position: fixed;
    right: 14px;
    bottom: 14px;
    width: min(420px, 42vw);
    height: 240px;
    z-index: 320;
    border-color: color-mix(in srgb, var(--accent) 42%, var(--line2));
    box-shadow: 0 14px 34px rgba(0, 0, 0, 0.45);
}

body[data-workspace-page="post"] .viewer-hud {
    min-height: 30px;
    padding: 0 6px;
    gap: 6px;
    cursor: move;
}

body[data-workspace-page="post"] .viewer-hud .badge {
    max-width: 46%;
}

body[data-workspace-page="post"] .viewer-hud .badge:nth-child(n + 3) {
    display: none;
}

body[data-workspace-page="card"] #modelCard,
body[data-workspace-page="card"] #textureCard,
body[data-workspace-page="card"] #modelShaderCard {
    display: none;
}

body[data-workspace-page="card"] #postGraphCard {
    display: none;
}

body[data-workspace-page="card"] .layout {
    grid-template-columns: minmax(0, 1fr);
    gap: 0;
}

body[data-workspace-page="card"] .panel.left,
body[data-workspace-page="card"] .resizer-left,
body[data-workspace-page="card"] .resizer-right {
    display: none;
}

body[data-workspace-page="card"] #kotlinCard {
    display: none;
}

body[data-workspace-page="post"] #nodeShaderSection {
    display: none;
}

body[data-workspace-page="card"] #nodeSettingsSection {
    display: none;
}

body[data-workspace-page="card"] .panel.right {
    width: 100%;
    max-width: none;
    padding-bottom: 26px;
}

body[data-workspace-page="card"] #nodeEditorCard {
    min-height: calc(100vh - var(--topbar-h) - 44px);
    display: flex;
    flex-direction: column;
}

body[data-workspace-page="card"] #nodeEditor {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
}

body[data-workspace-page="card"] #nodeShaderSection {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
}

body[data-workspace-page="card"] #nodeShaderActions {
    border-bottom: 1px solid var(--line);
    padding-top: 10px;
}

body[data-workspace-page="card"] #nodeShaderSection .form-grid {
    display: flex;
    flex-direction: column;
    flex: 1 1 auto;
    min-height: 0;
}

body[data-workspace-page="card"] #nodeFragmentField {
    flex: 1 1 auto;
    min-height: 0;
}

body[data-workspace-page="card"] #nodeFragmentField .editor-shell {
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 0;
}

body[data-workspace-page="card"] #nodeFragmentField .editor-body {
    flex: 1 1 auto;
    min-height: 360px;
    height: auto;
}

body[data-workspace-page="card"] .viewer {
    position: fixed;
    right: 14px;
    bottom: 14px;
    width: min(420px, 42vw);
    height: 240px;
    z-index: 320;
    border-color: color-mix(in srgb, var(--accent) 42%, var(--line2));
    box-shadow: 0 14px 34px rgba(0, 0, 0, 0.45);
}

body[data-workspace-page="card"] .viewer-hud {
    min-height: 30px;
    padding: 0 6px;
    gap: 6px;
}

body[data-workspace-page="card"] .viewer-hud .badge {
    max-width: 46%;
}

body[data-workspace-page="card"] .viewer-hud .badge:nth-child(n + 3) {
    display: none;
}

body[data-workspace-page="card"] .viewer-hud {
    cursor: move;
}

body.card-preview-dragging {
    user-select: none;
    cursor: move;
}

.tok-comment { color: #7d8aa5; }
.tok-pre { color: #ff8f66; }
.tok-string { color: #d1c881; }
.tok-num { color: #8ddfd7; }
.tok-type { color: #7ab7ff; }
.tok-key { color: #6ec0ff; }
.tok-builtin { color: #ffba7a; }
.tok-id { color: var(--text); }
.tok-unknown {
    color: color-mix(in srgb, var(--text) 88%, #ff6b6b);
    text-decoration-line: underline;
    text-decoration-style: wavy;
    text-decoration-color: #ff5a5a;
    text-underline-offset: 2px;
}

.kt-comment { color: #7d8aa5; }
.kt-string { color: #d1c881; }
.kt-num { color: #8ddfd7; }
.kt-type { color: #7ab7ff; }
.kt-key { color: #6ec0ff; }
.kt-id { color: var(--text); }

.actions-row {
    padding: 0 10px 10px;
}

.code {
    margin: 10px;
    min-height: 220px;
    max-height: 440px;
    overflow: auto;
    padding: 10px;
    border-radius: 12px;
    border: 1px solid var(--line);
    background: color-mix(in srgb, var(--panel2) 85%, transparent);
    font-family: "Cascadia Mono", Consolas, "JetBrains Mono", monospace;
    font-size: 12px;
    line-height: 1.55;
    white-space: pre;
}

.modal-mask {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.45);
    backdrop-filter: blur(3px);
    z-index: 100;
}

.modal {
    position: fixed;
    left: 50%;
    top: 50%;
    width: min(860px, 92vw);
    max-height: 86vh;
    transform: translate(-50%, -50%);
    border: 1px solid var(--line2);
    border-radius: 14px;
    background: linear-gradient(180deg, var(--panel), var(--panel2));
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.45);
    z-index: 101;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

.modal-head {
    height: 44px;
    border-bottom: 1px solid var(--line);
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0 10px;
}

.modal-title {
    font-weight: 600;
    flex: 1 1 auto;
}

.modal-body {
    padding: 10px;
    overflow: auto;
}

.modal-foot {
    height: 44px;
    border-top: 1px solid var(--line);
    display: flex;
    align-items: center;
    justify-content: flex-end;
    gap: 8px;
    padding: 0 10px;
}

.picker {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 10px;
    align-content: start;
}

.pickitem {
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 10px;
    cursor: pointer;
    text-align: left;
    background: color-mix(in srgb, var(--panel2) 78%, transparent);
    transition: transform .06s ease, border-color .15s ease, background .15s ease;
}

.pickitem:hover {
    transform: translateY(-1px);
    background: color-mix(in srgb, var(--panel2) 58%, transparent);
    border-color: color-mix(in srgb, var(--line2) 74%, #ffffff22);
}

.pickitem .t {
    font-weight: 700;
    margin-bottom: 4px;
}

.pickitem .d {
    font-size: 12px;
    color: var(--muted);
}

#nodeTypePickerModal {
    width: min(900px, 94vw);
}

.node-type-picker {
    min-height: 220px;
    max-height: 54vh;
    overflow: auto;
    padding-right: 4px;
}

.node-type-item.active {
    border-color: color-mix(in srgb, var(--accent) 66%, var(--line2));
    box-shadow: 0 0 0 1px color-mix(in srgb, var(--accent) 36%, transparent) inset;
}

.node-type-meta {
    margin-top: 8px;
    font-size: 11px;
    color: var(--muted);
}

.node-type-empty {
    border: 1px dashed var(--line2);
    border-radius: 12px;
    padding: 14px;
    color: var(--muted);
    font-size: 12px;
}

.settings-grid {
    display: grid;
    gap: 10px;
    grid-template-columns: repeat(2, minmax(0, 1fr));
}

.settings-actions {
    margin-top: 10px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.hk-list {
    display: grid;
    gap: 8px;
}

.hk-item {
    border: 1px solid var(--line);
    border-radius: 10px;
    padding: 8px;
    display: grid;
    grid-template-columns: 1fr auto auto;
    align-items: center;
    gap: 8px;
}

.hk-title {
    font-size: 13px;
}

.hk-desc {
    font-size: 12px;
    color: var(--muted);
}

.hk-key {
    min-width: 120px;
    text-align: center;
    border: 1px solid var(--line2);
    border-radius: 10px;
    padding: 6px 8px;
    font-size: 12px;
    background: color-mix(in srgb, var(--panel2) 72%, transparent);
}

.toast-host {
    position: fixed;
    right: 14px;
    bottom: 14px;
    display: grid;
    gap: 8px;
    z-index: 220;
}

.toast {
    min-width: 220px;
    max-width: min(480px, 80vw);
    border: 1px solid var(--line2);
    border-radius: 10px;
    padding: 8px 10px;
    font-size: 12px;
    background: color-mix(in srgb, var(--panel) 94%, transparent);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.35);
}

.toast.ok {
    border-color: color-mix(in srgb, var(--ok) 60%, var(--line2));
}

.toast.err {
    border-color: color-mix(in srgb, var(--danger) 62%, var(--line2));
}

@media (max-width: 1600px) {
    .layout {
        grid-template-columns: minmax(300px, var(--sb-left-w, 34vw)) 8px minmax(320px, 1fr) 8px minmax(340px, var(--sb-right-w, 36vw));
    }
}

@media (max-width: 1280px) {
    .layout {
        grid-template-columns: 1fr;
        overflow: auto;
    }

    .resizer {
        display: none;
    }

    .panel,
    .viewer {
        min-height: 420px;
    }

    .topbar {
        height: auto;
        padding: 8px;
        align-items: flex-start;
    }

    .topbar-left,
    .topbar-right {
        flex-wrap: wrap;
    }
}

@media (max-width: 900px) {
    .picker {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 980px) {
    body[data-workspace-page="card"] .viewer,
    body[data-workspace-page="post"] .viewer {
        width: calc(100vw - 20px);
        height: 200px;
        right: 10px;
        bottom: 10px;
    }
}
